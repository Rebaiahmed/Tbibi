angular.module("tbibi").controller("AppCtrl",["$scope","$ionicModal","$ionicPopover","$timeout","$state",function(e,t,o,n,i){e.loginData={},e.isExpanded=!1,e.hasHeaderFabLeft=!1,e.hasHeaderFabRight=!1;for(var a=document.getElementsByClassName("ion-navicon"),r=0;r<a.length;r++)a.addEventListener("click",function(){this.classList.toggle("active")});e.setExpanded=function(t){e.isExpanded=t},e.setHeaderFab=function(t){var o=!1,n=!1;switch(t){case"left":o=!0;break;case"right":n=!0}e.hasHeaderFabLeft=o,e.hasHeaderFabRight=n},e.hasHeader=function(){for(var e=document.getElementsByTagName("ion-content"),t=0;t<e.length;t++)e[t].classList.contains("has-header")||e[t].classList.toggle("has-header")},e.navigateTo=function(e){console.log("satteName"+e),i.go(e)},e.loginData={},t.fromTemplateUrl("templates2/login.html",{scope:e}).then(function(t){e.modal=t}),e.closeLogin=function(){e.modal.hide()},e.login=function(){e.modal.show()}}]).controller("RechercheCtrl",["$scope","$timeout","$ionicPopover","$ionicLoading","$ionicModal","$state","RechercherSevice","$filter","getDocteurs","getSpecialitees",function(e,t,o,n,i,a,r,c,s,l){e.$on("$ionicView.beforeEnter",function(){console.log("Running stuff..."),n.show({template:'<ion-spinner icon="dots"></ion-spinner>',hideOnStageChange:!0,animation:"fade-in",showBackdrop:!0,maxWidth:200,showDelay:0}),t(function(){n.hide()},2e3)}),i.fromTemplateUrl("templates2/modal.html",{scope:e,animation:"slide-in-up",focusFirstInput:!0}).then(function(t){e.modal=t}),e.openModal=function(){e.modal.show()},e.closeModal=function(){e.modal.hide()},e.$on("$destroy",function(){e.modal.remove()}),e.$on("modal.hidden",function(){}),e.$on("modal.removed",function(){}),o.fromTemplateUrl("templates2/popover.html",{scope:e}).then(function(t){e.popover=t}),e.data={},e.data.specialite="",e.data.gouvernorat="",e.data.delegation="",e.doctor={},e.specialites=[],e.searchDoc={},e.errorDoctor=!1,e.errorSpecilaite=!1,angular.forEach(l,function(t,o){t=angular.fromJson(t),e.specialites[o]=t.specialite}),console.log("abstract state !"),e.gouvernorats=["Ariana","Ben Arous","Mannouba","Tunis"],e.delegations=["Ariana Ville","Ariana Nouvelle","Ariana Sup","El Menzah 9"],e.docteurs=[];var d={};angular.forEach(s,function(t,o){t=angular.fromJson(t),d.id=t.id_praticien,d.prenom_praticien=t.prenom_praticien,d.nom_praticien=t.nom_praticien,e.docteurs[o]=d,d={}}),e.rechercheParCritere=function(){n.show({content:"Loading",animation:"fade-in",showBackdrop:!0,maxWidth:200,showDelay:0}),e.data.specialite?r.RechercheParCritere(e.data).then(function(t){n.hide(),0==t.data.Number?e.openModal():a.go("app.resultas",{resultats:JSON.stringify(t.data)})}).catch(function(e){n.hide(),console.log("eer"+JSON.stringify(e))}):(e.errorSpecilaite=!0,n.hide())},e.rechercheParNom=function(){n.show({content:"Loading",animation:"fade-in",showBackdrop:!0,maxWidth:200,showDelay:0}),e.data.doctor?(console.log("id is"+e.data.doctor.id),r.RechercheDocteur(e.data.doctor.id).then(function(t){n.hide(),console.log("result"+JSON.stringify(t)),t?a.go("app.docteursDetails",{id:t.id_praticien}):e.openModal()}).catch(function(e){n.hide(),console.log("err"+e)})):(e.errorDoctor=!0,n.hide())}}]).controller("ResultatsCtrl",["$scope","$ionicLoading","$timeout","$stateParams","$state","localStorageService",function(e,t,o,n,i,a){if(e.$on("$ionicView.beforeEnter",function(){console.log("Running stuff..."),t.show({template:'<ion-spinner icon="dots"></ion-spinner>',hideOnStageChange:!0,animation:"fade-in",showBackdrop:!0,maxWidth:200,showDelay:0}),o(function(){t.hide()},2e3)}),n.resultats=angular.fromJson(n.resultats),e.Resultats=[],n.resultats)for(var r=0;r<n.resultats.Number;r++)e.Resultats[r]=angular.fromJson(n.resultats.Resultats[r]);e.gotoDocteurDetails=function(e){i.go("app.docteursDetails",{id:e})},console.log("resultats are"+JSON.stringify(e.Resultats)),e.goMpas=function(){console.log("go to maps !"),i.go("app.maps",{Resultats:JSON.stringify(e.Resultats)})}}]).controller("MapsCtrl",["$stateParams","$http","$scope",function(e,t,o){var n,i;if(e.Resultats=angular.fromJson(e.Resultats),console.log("params are"+e.Resultats.length),o.Resultats=[],e.Resultats)for(var a=0;a<e.Resultats.length;a++)o.Resultats[a]=e.Resultats[a];angular.extend(o,{center:{lat:36.7908,lng:10.1112,zoom:10},layers:{baselayers:{osm:{name:"OpenStreetMap",url:"http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",type:"xyz"}},overlays:{earthquake:{name:"earthquake",type:"markercluster",visible:!0}}}}),o.markers=[];for(var a=0;a<o.Resultats.length;a++)n=parseFloat(o.Resultats[a].latitude),i=parseFloat(o.Resultats[a].longitude),console.log("i"+n+" long"+i),o.markers[a]={lat:n,lng:i,message:" "+o.Resultats[a].nom_praticien+" "+o.Resultats[a].prenom_praticien+"</br>Tel:"+o.Resultats[a].phone__fixe_praticien+"</br>Specialite :"+o.Resultats[a].specialite,focus:!0,draggable:!1};angular.extend(o,{markers:o.markers})}]).controller("clientLoginCtrl",["$scope","$ionicLoading","$timeout","PatientService","$state","$rootScope",function(e,t,o,n,i,a){e.$on("$ionicView.beforeEnter",function(){console.log("clien tlogin client..."),t.show({template:'<ion-spinner icon="dots"></ion-spinner>',hideOnStageChange:!0,animation:"fade-in",showBackdrop:!0,maxWidth:200,showDelay:0}),o(function(){t.hide()},2e3)}),e.submitted=!1,e.emailInexistant=!1,e.passwordInvalide=!1,e.client={},e.loginClient=function(o){e.submitted=!0,o&&(t.show({content:"Loading",animation:"fade-in",showBackdrop:!0,maxWidth:200,showDelay:0}),n.seConnecter(e.client).then(function(o){console.log("client"+JSON.stringify(o.data)),t.hide(),404==o.data.error.code?(console.log("error in submit"),e.emailInexistant=!0):(console.log("client logged"),a.clientAuthenticated=!0,n.setPatient(o.data),i.go("app.dashaBordClient"))}).catch(function(e){t.hide()}))}}]).controller("clientInscriptionCtrl",["$scope","ionicDatePicker","$ionicLoading","$timeout","PatientService","$rootScope","$state","$ionicModal",function(e,t,o,n,i,a,r,c){e.$on("$ionicView.beforeEnter",function(){console.log("client inscription client..."),o.show({template:'<ion-spinner icon="dots"></ion-spinner>',hideOnStageChange:!0,animation:"fade-in",showBackdrop:!0,maxWidth:200,showDelay:0}),n(function(){o.hide()},2e3)}),c.fromTemplateUrl("templates2/EmailInvalide.html",{scope:e,animation:"slide-in-up"}).then(function(t){e.modal=t}),e.openModal=function(){e.modal.show()},e.closeModal=function(){e.modal.hide()},e.$on("$destroy",function(){e.modal.remove()}),e.$on("modal.hidden",function(){}),e.$on("modal.removed",function(){}),e.newClient={};var s={callback:function(t){console.log("Return value from the datepicker popup is : "+t,new Date(t)),e.newClient.dateNaissance=new Date(t),console.log("the date is"+typeof e.newClient.dateNaissance)},from:new Date(1940,1,1),to:new Date(2016,10,30),inputDate:new Date,mondayFirst:!0,closeOnSelect:!0,templateType:"popup"};e.openDatePicker=function(){t.openDatePicker(s)},e.accept1=!0,e.accept2=!0,e.phNumber="^[1-9][0-9]{7}$",e.submitted=!1,e.inscrireClient=function(t){e.submitted=!0,t&&(o.show({content:"Loading",animation:"fade-in",showBackdrop:!0,maxWidth:200,showDelay:0}),i.inscrire(e.newClient).then(function(t){o.hide(),console.log("data"+(401==t.data.error.code)),401==t.data.error.code?e.openModal():(console.log("success dinscription"),a.clientAuthenticated=!0,i.setPatient(t.data),r.go("app.dashaBordClient"))}).catch(function(e){o.hide(),console.log("erreur"+JSON.stringify(e))}))}}]).controller("praticienLoginCtrl",["$scope","$timeout","$ionicLoading","DocteurService","$rootScope","$state",function(e,t,o,n,i,a){e.$on("$ionicView.beforeEnter",function(){console.log("praticien login..."),o.show({template:'<ion-spinner icon="dots"></ion-spinner>',hideOnStageChange:!0,animation:"fade-in",showBackdrop:!0,maxWidth:200,showDelay:0}),t(function(){o.hide()},2e3)}),e.submitted=!1,e.emailInexistant=!1,e.passwordInvalide=!1,e.praticient={},e.loginPraticient=function(t){console.log("form pratcine tlogin"+t),e.submitted=!0,t&&(o.show({content:"Loading",animation:"fade-in",showBackdrop:!0,maxWidth:200,showDelay:0}),n.seConnecter(e.praticient).then(function(t){o.hide(),console.log("patrticn"+JSON.stringify(t.data)),404==t.data.error.code?e.emailInexistant=!0:(console.log("praticne logged"),n.setPraticient(t.data),i.praticientAuthenticated=!0,a.go("app.dashaBordPraticien"))}).catch(function(e){console.log("err"+e)}))}}]).controller("praticienInscriptionCtrl",["$scope","$ionicModal","$timeout","DocteurService","$ionicLoading","$rootScope","$state",function(e,t,o,n,i,a,r){e.$on("$ionicView.beforeEnter",function(){console.log("praticien login..."),i.show({template:'<ion-spinner icon="dots"></ion-spinner>',hideOnStageChange:!0,animation:"fade-in",showBackdrop:!0,maxWidth:200,showDelay:0}),o(function(){i.hide()},2e3)}),e.submitted=!1,e.codeInvalide=!1,e.newDocteur={},e.inscrireDocteur=function(t){e.submitted=!0,t&&(i.show({template:'<ion-spinner icon="dots"></ion-spinner>',hideOnStageChange:!0,animation:"fade-in",showBackdrop:!0,maxWidth:200,showDelay:0}),n.inscrire(e.newDocteur).then(function(t){i.hide(),console.log("result"+JSON.stringify(t.data)),401==t.data.error.code?(console.log("invalide code"),e.codeInvalide=!0):(console.log("praticne logged"),n.setPraticient(t.data),a.praticientAuthenticated=!0,r.go("app.dashaBordPraticien"))}).catch(function(e){i.hide(),console.log("err"+e)}))}}]).controller("dashabordClientCtrl",["$scope","$ionicModal","$timeout","ionicMaterialMotion","ionicMaterialInk","$ionicLoading","$ionicHistory","PatientService","ionicToast","$state","$rootScope",function(e,t,o,n,i,a,r,c,s,l,d){e.$on("$ionicView.beforeEnter",function(){console.log("praticien login..."),a.show({template:'<ion-spinner icon="dots"></ion-spinner>',hideOnStageChange:!0,animation:"fade-in",showBackdrop:!0,maxWidth:200,showDelay:0}),o(function(){a.hide()},2e3)}),e.phNumber="^[1-9][0-9]{7}$",c.getPatient()&&(e.Client=JSON.parse(c.getPatient()),e.Client.userData.date_naissance=new Date(e.Client.userData.date_naissance)),e.isExpanded=!1,e.$parent.setExpanded(!1),e.$parent.setHeaderFab(!1),o(function(){n.slideUp({selector:".slide-up"})},300),o(function(){n.fadeSlideInRight({startVelocity:3e3})},700),i.displayEffect(),e.modifierProfile=function(t){e.submitted=!0,a.show({template:'<ion-spinner icon="dots"></ion-spinner>',hideOnStageChange:!0,animation:"fade-in",showBackdrop:!0,maxWidth:200,showDelay:0}),console.log("isvalid"),t&&c.modifierProfile(e.Client.userData).then(function(e){a.hide(),console.log("result is"+JSON.stringify(e)),c.setPatient(e),s.show("Votre profile a été modifié avec succées ","top",!0,2500)}).catch(function(e){a.hide(),s.show("Erreur veuillez réssayez plus tard ! ","top",!0,2500),console.log("err"+JSON.stringify(e))})},e.logout=function(){c.logout(),s.show("déconnecter from our app","top",!0,2500),d.clientAuthenticated=!1,l.go("app.recherche")}}]).controller("dashabordPraticienCtrl",["$scope","$ionicModal","$timeout","$ionicLoading","$ionicHistory","DocteurService","$rootScope","$state","ionicToast",function(e,t,o,n,i,a,r,c,s){e.$on("$ionicView.beforeEnter",function(){console.log("praticien login..."),n.show({template:'<ion-spinner icon="dots"></ion-spinner>',hideOnStageChange:!0,animation:"fade-in",showBackdrop:!0,maxWidth:200,showDelay:0}),o(function(){n.hide()},2e3)}),a.getDocteur()&&(e.Docteur=JSON.parse(a.getDocteur())),e.checked=!1,e.refused=!1,e.confirmerRendezVous=function(t){l.idRdv=t,l.idDoctor=e.Docteur.userData.id_praticien,n.show({template:'<ion-spinner icon="dots"></ion-spinner>',hideOnStageChange:!0,animation:"fade-in",showBackdrop:!0,maxWidth:200,showDelay:0}),a.confirmerRendezVous(l).then(function(t){console.log("result"+JSON.stringify(t)),n.hide(),a.setPraticient(t.data),e.Docteur=JSON.parse(a.getDocteur()),e.refused=!0,s.show("le Rendez Vous est confirmee.","top",!0,2500)}).catch(function(e){console.log("err"+e)})};var l={};e.rejeterRendezVous=function(t){l.idRdv=t,l.idDoctor=e.Docteur.userData.id_praticien,n.show({template:'<ion-spinner icon="dots"></ion-spinner>',hideOnStageChange:!0,animation:"fade-in",showBackdrop:!0,maxWidth:200,showDelay:0}),a.RejeterRendezVous(l).then(function(t){n.hide(),a.setPraticient(t.data),e.Docteur=JSON.parse(a.getDocteur()),e.refused=!0,s.show("le Rendez Vous est Rejetée.","top",!0,2500)}).catch(function(e){console.log("err"+e)})},e.submitted=!1,e.modifierProfile=function(t){console.log("ok ok ok"),e.submitted=!0},e.logout=function(){a.logout(),s.show("Déconnecter","top",!0,2500),r.praticientAuthenticated=!1,c.go("app.recherche.specialite")},e.refresh=function(){console.log("rfersh data from server!"),n.show({content:"Loading",animation:"fade-in",showBackdrop:!0,maxWidth:200,showDelay:0}),a.refresh(e.Docteur.userData.id_praticien).then(function(t){console.log("data are"+JSON.stringify(t)),n.hide(),a.setPraticient(t.data),e.Docteur=JSON.parse(a.getDocteur())}).catch(function(e){console.log("err"+e)})}}]).controller("DocteurDetailsCtrl",["$scope","$ionicModal","$timeout","$cordovaCalendar","getDocteur","PatientService","$ionicSlideBoxDelegate","ionicDatePicker","$ionicPopup",function(e,t,o,n,i,a,r,c,s){function l(){for(var e=[],t=0;t<50;t+=1){var o,n,i=new Date,a=Math.floor(2*Math.random()),r=Math.floor(90*Math.random())-45,c=Math.floor(2*Math.random())+r;if(0===a)o=new Date(Date.UTC(i.getUTCFullYear(),i.getUTCMonth(),i.getUTCDate()+r)),c===r&&(c+=1),n=new Date(Date.UTC(i.getUTCFullYear(),i.getUTCMonth(),i.getUTCDate()+c)),e.push({title:"All Day - "+t,startTime:o,endTime:n,allDay:!0});else{var s=Math.floor(24*Math.random()*60),l=Math.floor(180*Math.random())+s;o=new Date(i.getFullYear(),i.getMonth(),i.getDate()+r,0,i.getMinutes()+s),n=new Date(i.getFullYear(),i.getMonth(),i.getDate()+c,0,i.getMinutes()+l),e.push({title:"Event - "+t,startTime:o,endTime:n,allDay:!1})}}return e}e.Docteur=i;var d=new Date,u=new Date;u.setDate(d.getDate()+7);var h={callback:function(t){console.log("Return value from the datepicker popup is : "+t,new Date(t)),e.RDV.date=new Date(t)},disabledDates:[],from:new Date,to:new Date(2017,8,1),inputDate:new Date,mondayFirst:!0,closeOnSelect:!0,templateType:"popup"};e.openDatePicker=function(){c.openDatePicker(h)},t.fromTemplateUrl("/templates2/Docteur/PrendreRdv.html",{scope:e,animation:"slide-in-up",focusFirstInput:!0}).then(function(t){e.modal=t}),e.openModal=function(){e.modal.show()},e.closeModal=function(){e.modal.hide()},e.$on("$destroy",function(){e.modal.remove()}),e.$on("modal.hidden",function(){}),e.$on("modal.removed",function(){}),e.myActiveSlide=1,e.slidePrevious=function(){r.previous()},e.slideNext=function(){r.next()},e.temps=["9h","10h","11h","12h","14h","15h","16h","17h"],e.RDV={},e.showAlert=function(){var e=s.alert({title:"Alerte",template:"Vous devez étre authentifié pour prendre un rendez vous !"});e.then(function(e){console.log("Thank you for not eating my delicious ice cream cone")})},e.submitted=!1,e.prendreRdv=function(){if(e.submitted=!0,a.getPatient()){var t=angular.fromJson(a.getPatient());console.log("client"+JSON.stringify(t.userData.id_patient)),console.log("docteur"+JSON.stringify(e.Docteur.id_praticien)),e.RDV.id_patient=t.userData.id_patient,e.RDV.id_praticien=e.Docteur.id_praticien}a.getPatient()?a.prendreRendezVous(e.RDV).then(function(e){console.log("data"+e.data.etat),200==e.data.etat&&alert("suucess cretaed !")}).catch(function(e){console.log("err"+e)}):e.showAlert()},e.calendar={},e.changeMode=function(t){e.calendar.mode=t},e.loadEvents=function(){e.calendar.eventSource=l()},e.onEventSelected=function(e){console.log("Event selected:"+e.startTime+"-"+e.endTime+","+e.title)},e.onViewTitleChanged=function(t){e.viewTitle=t},e.today=function(){e.calendar.currentDate=new Date},e.isToday=function(){var t=new Date,o=new Date(e.calendar.currentDate);return t.setHours(0,0,0,0),o.setHours(0,0,0,0),t.getTime()===o.getTime()},e.onTimeSelected=function(e,t){console.log("Selected time: "+e+", hasEvents: "+(void 0!==t&&0!==t.length))}}]).controller("RdvsCtrl",["$scope","$ionicModal","$timeout",function(e,t,o){e.RendezVous=""}]);
