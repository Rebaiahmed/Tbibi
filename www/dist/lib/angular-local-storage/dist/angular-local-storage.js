!function(e,t){var o=t.isDefined,r=t.isUndefined,n=t.isNumber,i=t.isObject,a=t.isArray,c=t.extend,s=t.toJson;t.module("LocalStorageModule",[]).provider("localStorageService",function(){this.prefix="ls",this.storageType="localStorage",this.cookie={expiry:30,path:"/",secure:!1},this.defaultToCookie=!0,this.notify={setItem:!0,removeItem:!1},this.setPrefix=function(e){return this.prefix=e,this},this.setStorageType=function(e){return this.storageType=e,this},this.setDefaultToCookie=function(e){return this.defaultToCookie=!!e,this},this.setStorageCookie=function(e,t,o){return this.cookie.expiry=e,this.cookie.path=t,this.cookie.secure=o,this},this.setStorageCookieDomain=function(e){return this.cookie.domain=e,this},this.setNotify=function(e,t){return this.notify={setItem:e,removeItem:t},this},this.$get=["$rootScope","$window","$document","$parse","$timeout",function(e,t,u,l,g){function f(o){if(o||(o=t.event),p.setItem&&k(o.key)){var r=v(o.key);g(function(){e.$broadcast("LocalStorageModule.notification.changed",{key:r,newvalue:o.newValue,storageType:h.storageType})})}}var d,h=this,T=h.prefix,m=h.cookie,p=h.notify,S=h.storageType;u?u[0]&&(u=u[0]):u=document,"."!==T.substr(-1)&&(T=T?T+".":"");var y=function(e){return T+e},v=function(e){return e.replace(new RegExp("^"+T,"g"),"")},k=function(e){return 0===e.indexOf(T)},O=function(){try{var o=S in t&&null!==t[S],r=y("__"+Math.round(1e7*Math.random()));return o&&(d=t[S],d.setItem(r,""),d.removeItem(r)),o}catch(t){return h.defaultToCookie&&(S="cookie"),e.$broadcast("LocalStorageModule.notification.error",t.message),!1}},b=O(),L=function(t,o,n){if(P(n),o=r(o)?null:s(o),!b&&h.defaultToCookie||"cookie"===h.storageType)return b||e.$broadcast("LocalStorageModule.notification.warning","LOCAL_STORAGE_NOT_SUPPORTED"),p.setItem&&e.$broadcast("LocalStorageModule.notification.setitem",{key:t,newvalue:o,storageType:"cookie"}),C(t,o);try{d&&d.setItem(y(t),o),p.setItem&&e.$broadcast("LocalStorageModule.notification.setitem",{key:t,newvalue:o,storageType:h.storageType})}catch(r){return e.$broadcast("LocalStorageModule.notification.error",r.message),C(t,o)}return!0},$=function(t,o){if(P(o),!b&&h.defaultToCookie||"cookie"===h.storageType)return b||e.$broadcast("LocalStorageModule.notification.warning","LOCAL_STORAGE_NOT_SUPPORTED"),_(t);var r=d?d.getItem(y(t)):null;if(!r||"null"===r)return null;try{return JSON.parse(r)}catch(e){return r}},E=function(){var t=0;arguments.length>=1&&("localStorage"===arguments[arguments.length-1]||"sessionStorage"===arguments[arguments.length-1])&&(t=1,P(arguments[arguments.length-1]));var o,r;for(o=0;o<arguments.length-t;o++)if(r=arguments[o],!b&&h.defaultToCookie||"cookie"===h.storageType)b||e.$broadcast("LocalStorageModule.notification.warning","LOCAL_STORAGE_NOT_SUPPORTED"),p.removeItem&&e.$broadcast("LocalStorageModule.notification.removeitem",{key:r,storageType:"cookie"}),R(r);else try{d.removeItem(y(r)),p.removeItem&&e.$broadcast("LocalStorageModule.notification.removeitem",{key:r,storageType:h.storageType})}catch(t){e.$broadcast("LocalStorageModule.notification.error",t.message),R(r)}},M=function(t){if(P(t),!b)return e.$broadcast("LocalStorageModule.notification.warning","LOCAL_STORAGE_NOT_SUPPORTED"),[];var o=T.length,r=[];for(var n in d)if(n.substr(0,o)===T)try{r.push(n.substr(o))}catch(t){return e.$broadcast("LocalStorageModule.notification.error",t.Description),[]}return r},w=function(t,o){P(o);var r=T?new RegExp("^"+T):new RegExp,n=t?new RegExp(t):new RegExp;if(!b&&h.defaultToCookie||"cookie"===h.storageType)return b||e.$broadcast("LocalStorageModule.notification.warning","LOCAL_STORAGE_NOT_SUPPORTED"),I();if(!b&&!h.defaultToCookie)return!1;var i=T.length;for(var a in d)if(r.test(a)&&n.test(a.substr(i)))try{E(a.substr(i))}catch(t){return e.$broadcast("LocalStorageModule.notification.error",t.message),I()}return!0},x=function(){try{return t.navigator.cookieEnabled||"cookie"in u&&(u.cookie.length>0||(u.cookie="test").indexOf.call(u.cookie,"test")>-1)}catch(t){return e.$broadcast("LocalStorageModule.notification.error",t.message),!1}}(),C=function(t,o,c,l){if(r(o))return!1;if((a(o)||i(o))&&(o=s(o)),!x)return e.$broadcast("LocalStorageModule.notification.error","COOKIES_NOT_SUPPORTED"),!1;try{var g="",f=new Date,d="";if(null===o?(f.setTime(f.getTime()+-864e5),g="; expires="+f.toGMTString(),o=""):n(c)&&0!==c?(f.setTime(f.getTime()+24*c*60*60*1e3),g="; expires="+f.toGMTString()):0!==m.expiry&&(f.setTime(f.getTime()+24*m.expiry*60*60*1e3),g="; expires="+f.toGMTString()),t){var h="; path="+m.path;m.domain&&(d="; domain="+m.domain),"boolean"==typeof l?l===!0&&(d+="; secure"):m.secure===!0&&(d+="; secure"),u.cookie=y(t)+"="+encodeURIComponent(o)+g+h+d}}catch(t){return e.$broadcast("LocalStorageModule.notification.error",t.message),!1}return!0},_=function(t){if(!x)return e.$broadcast("LocalStorageModule.notification.error","COOKIES_NOT_SUPPORTED"),!1;for(var o=u.cookie&&u.cookie.split(";")||[],r=0;r<o.length;r++){for(var n=o[r];" "===n.charAt(0);)n=n.substring(1,n.length);if(0===n.indexOf(y(t)+"=")){var i=decodeURIComponent(n.substring(T.length+t.length+1,n.length));try{return JSON.parse(i)}catch(e){return i}}}return null},R=function(e){C(e,null)},I=function(){for(var e=null,t=T.length,o=u.cookie.split(";"),r=0;r<o.length;r++){for(e=o[r];" "===e.charAt(0);)e=e.substring(1,e.length);var n=e.substring(t,e.indexOf("="));R(n)}},A=function(){return S},P=function(e){return e&&S!==e&&(S=e,b=O()),b},D=function(e,t,r,n,a){n=n||t;var s=$(n,a);return null===s&&o(r)?s=r:i(s)&&i(r)&&(s=c(s,r)),l(t).assign(e,s),e.$watch(t,function(e){L(n,e,a)},i(e[t]))};b&&(t.addEventListener?(t.addEventListener("storage",f,!1),e.$on("$destroy",function(){t.removeEventListener("storage",f)})):t.attachEvent&&(t.attachEvent("onstorage",f),e.$on("$destroy",function(){t.detachEvent("onstorage",f)})));var N=function(e){P(e);for(var o=0,r=t[S],n=0;n<r.length;n++)0===r.key(n).indexOf(T)&&o++;return o};return{isSupported:b,getStorageType:A,setStorageType:P,set:L,add:L,get:$,keys:M,remove:E,clearAll:w,bind:D,deriveKey:y,underiveKey:v,length:N,defaultToCookie:this.defaultToCookie,cookie:{isSupported:x,set:C,add:C,get:_,remove:R,clearAll:I}}}]})}(window,window.angular);